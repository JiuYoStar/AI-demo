# 🚀 Python 程序后台运行与进程管理指南

## 1. 常见方式

### 1.1 nohup + &
最简单的后台运行方式。
```bash
# 启动
nohup python your_script.py > app.log 2>&1 &

# 查看进程
ps -ef | grep your_script.py

# 查看日志
tail -f app.log
```

特点：简单易用，退出终端后程序仍运行。
缺点：不能自动重启，功能有限。

---

### 1.2 tmux / screen
通过持久化会话保持进程运行。

```bash
# 新建会话
tmux new -s myapp
python your_script.py

# 按 Ctrl+B D 退出会话（不关闭程序）
# 重新进入
tmux attach -t myapp
```

特点：方便调试，能直接交互。
缺点：不能自动重启，日志需自行管理。

---

### 1.3 systemd（Linux 原生推荐）
写一个服务文件，让系统管理进程。

**配置文件 `/etc/systemd/system/myapp.service`**
```ini
[Unit]
Description=My Python App
After=network.target

[Service]
ExecStart=/usr/bin/python /path/to/your_script.py
WorkingDirectory=/path/to
Restart=always
StandardOutput=append:/var/log/myapp.log
StandardError=append:/var/log/myapp.err
User=youruser

[Install]
WantedBy=multi-user.target
```

**常用命令**
```bash
sudo systemctl daemon-reload      # 重新加载配置
sudo systemctl start myapp        # 启动服务
sudo systemctl stop myapp         # 停止服务
sudo systemctl restart myapp      # 重启服务
sudo systemctl enable myapp       # 设置开机自启
journalctl -u myapp -f            # 查看实时日志
```

特点：系统级管理，支持自动重启、开机自启，日志统一。
缺点：需要 root 权限和配置文件。

---

### 1.4 Supervisor
Python 社区常见的进程管理器。

**配置文件 `/etc/supervisor/conf.d/myapp.conf`**
```ini
[program:myapp]
command=python /path/to/your_script.py
directory=/path/to
autostart=true
autorestart=true
stdout_logfile=/var/log/myapp.log
stderr_logfile=/var/log/myapp.err
```

**常用命令**
```bash
supervisord -c /etc/supervisor/supervisord.conf   # 启动守护进程
supervisorctl start myapp                         # 启动
supervisorctl stop myapp                          # 停止
supervisorctl restart myapp                       # 重启
supervisorctl status                              # 状态
tail -f /var/log/myapp.log                        # 查看日志
```

特点：配置简单，支持多进程管理，自动重启。
缺点：需要额外安装，日志管理比 systemd 简单。

---

### 1.5 PM2
跨平台进程管理器，最初为 Node.js 设计，但可管理任意命令。

```bash
# 启动
pm2 start "python your_script.py" --name myapp

# 查看状态
pm2 status

# 查看日志
pm2 logs myapp

# 停止/重启
pm2 stop myapp
pm2 restart myapp

# 开机自启
pm2 startup
pm2 save
```

特点：跨平台，操作简单，日志管理友好，自带 Web 监控。
缺点：不是 Linux 原生工具，大规模生产环境常用 systemd/k8s 代替。

---

## 2. 横向对比

| 工具         | 优点 | 缺点 | 适用场景 |
|--------------|------|------|----------|
| **nohup**    | 简单易用，命令行一行搞定 | 无法自动重启，日志需手动 | 临时运行、测试脚本 |
| **tmux/screen** | 可交互，断开不中断，适合调试 | 无法自动重启，日志需自己处理 | 调试、需要实时交互的脚本 |
| **systemd**  | Linux 原生，支持开机自启、自动重启，日志统一 | 配置相对复杂 | 企业级生产环境 |
| **supervisor** | 配置简单，支持多进程，自动重启 | 需额外安装，日志功能较弱 | 中小型生产环境 |
| **PM2**      | 跨平台，命令简洁，支持日志、监控 | 非原生工具，大型生产不常用 | 开发测试、中小型部署 |

---

## ✅ 总结
- **快速测试/一次性任务** → `nohup`
- **调试 & 持续会话** → `tmux/screen`
- **中小规模生产** → `supervisor` / `pm2`
- **企业级生产环境** → `systemd`（或 Kubernetes 容器编排）

> 建议：开发测试用 **PM2 / nohup**，生产环境用 **systemd**。
