# 环境变量配置说明

## 问题说明

使用 `export` 命令设置的环境变量只在**当前终端会话**中有效,关闭终端或在不同的Shell中运行程序时,环境变量会丢失。

## 解决方案

### 方案1:永久设置到 Shell 配置文件(适合个人开发环境)

环境变量已添加到 `~/.zshrc` 文件中,每次打开新的终端都会自动加载。

```bash
# 查看配置
cat ~/.zshrc | grep DASHSCOPE_API_KEY

# 如果需要立即生效(在当前终端)
source ~/.zshrc
```

**优点:**
- 所有终端会话都能访问
- 适合个人开发环境
- 一次配置,永久生效

**缺点:**
- API Key 明文存储在配置文件中
- 不适合团队协作
- 容易被误提交到Git仓库

---

### 方案2:使用 .env 文件(推荐,适合项目管理)

项目已配置使用 `.env` 文件管理环境变量。

#### 文件结构

```
test/
├── .env              # 实际的API Key(已被Git忽略)
├── .env.example      # 示例模板(可以提交到Git)
└── test3.py          # 使用 python-dotenv 加载环境变量
```

#### 使用方法

1. **安装依赖**
   ```bash
   pip install python-dotenv
   ```

2. **在代码中加载 .env 文件**
   ```python
   from dotenv import load_dotenv
   import os

   # 加载 .env 文件
   load_dotenv()

   # 读取环境变量
   api_key = os.getenv("DASHSCOPE_API_KEY")
   ```

3. **创建 .env 文件**(项目根目录)
   ```
   DASHSCOPE_API_KEY=sk-7dea7af8f1824bedab1a176e92e42fe6
   ```

4. **创建 .env.example 模板**(可提交到Git)
   ```
   DASHSCOPE_API_KEY=your_api_key_here
   ```

5. **配置 .gitignore**(防止泄露API Key)
   ```
   .env
   ```

**优点:**
- ✅ API Key 不会被提交到Git仓库
- ✅ 适合团队协作(通过 .env.example 共享配置模板)
- ✅ 易于在不同环境(开发/测试/生产)切换配置
- ✅ 项目独立,不影响系统环境

**缺点:**
- 需要额外安装 `python-dotenv` 依赖

---

## 测试验证

```bash
# 运行测试脚本
cd /Users/lingk/work/py/demo/test
source venv/bin/activate
python test3.py
```

预期输出:
```
DASHSCOPE_API_KEY: sk-7dea7af8f1824bedab1a176e92e42fe6
[API 响应流式输出...]
```

---

## 最佳实践

1. **开发环境**: 使用 `.env` 文件
2. **生产环境**: 使用系统环境变量或密钥管理服务
3. **团队协作**: 提交 `.env.example`,不提交 `.env`
4. **多环境**: 使用 `.env.development`、`.env.production` 等

## 常见问题

### Q: 为什么 os.getenv() 读取不到环境变量?
A: 确保:
1. `.env` 文件存在且格式正确
2. 代码中调用了 `load_dotenv()`
3. 环境变量名称拼写正确

### Q: 如何在其他Python文件中使用?
A: 在每个需要使用环境变量的文件开头添加:
```python
from dotenv import load_dotenv
load_dotenv()
```

### Q: 可以设置多个环境变量吗?
A: 可以,在 `.env` 文件中每行一个:
```
DASHSCOPE_API_KEY=sk-xxx
DATABASE_URL=postgresql://...
DEBUG=True
```

